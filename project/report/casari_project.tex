\documentclass[a4paper,10pt,draft,twocolumn]{article}

% Packages.
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[style=ieee,backend=biber]{biblatex}
%\usepackage{booktabs}
%\usepackage{caption}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
%\usepackage{mathtools}
%\usepackage{physics}
\usepackage{siunitx}
%\usepackage{subcaption}
%\usepackage{subfiles}
%\usepackage{tabularx}
%\usepackage{varioref}
\usepackage{xcolor}

% Packages settings.
\addbibresource{bibliography.bib}
%\captionsetup{tableposition=top,figureposition=bottom,font=footnotesize,format=hang,subrefformat=parens}
\hypersetup{hidelinks}
%\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\graphicspath{{./figures/}}
\sisetup{group-digits=integer,separate-uncertainty,per-mode=fraction}

% Customization.
\definecolor{Blue}{rgb}{0.2,0.2,0.9}
\definecolor{Green}{rgb}{0,0.6,0}
\definecolor{Gray}{rgb}{0.5,0.5,0.5}
\definecolor{Purple}{rgb}{0.58,0,0.82}
\definecolor{background}{rgb}{0.98,0.98,0.95}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{background},
  commentstyle=\color{Green},
  keywordstyle=\color{Blue},
  numberstyle=\tiny\color{Gray},
  stringstyle=\color{Purple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2
}
\lstset{style=mystyle}

\newcommand{\cpp}{C++}
\newcommand{\dd}{\mathop{}\!\mathrm{d}}

\raggedbottom

% Document.
\begin{document}
\title{Study Nuclear Winter with a radiative-convective climate model} % MC choose title.
\author{Marco Casari}
\date{\today}
\maketitle

\begin{abstract}
  % MC abstract.
\end{abstract}

% MC add if needed, probably not.
%\tableofcontents
%\newpage

\section{Introduction}
% MC the aim of this project is presented.
% MC the physical background is presented.

%\section{Materials}

\section{Methods}
% MC explain the atmosphere model: vertical column where each layer present quantities averaged over the global atmosphere.
% MC explain the subdivision between the radiative part and the convective part.
% MC distinguish in appropriate subsections the treatment of shortwave and longwave radiations and radiation scattering vs absorption.
% MC describe conventions used in this work.

\subsection{Hypotheses and conventions}
\label{sec:Hypotheses and conventions}
To simplify some calculations for radiative fluxes, the definition of wavenumber $\nu = \frac{1}{\lambda}$ is used in this work, where $\lambda$ is the wavelenght.

Specific gas constant is used in thermodynamical relations, which is defined as the gas constant divided by the gas molar mass. In this work the symbol $R$ is used for the specific gas constant.

Some assumptions are made on the dynamical state and the composition of Earth's atmosphere. 
% MC do I need to use the International Standard Atmosphere? It is not a good choice since its temperature profile is already fixed. But I can take it as reference for other parametrizations.
Gravitational acceleration is constant (cfr. Table~\ref{tab:constants} for values). Air parcels are supposed to be in hydrostatic equilibrium,
\begin{equation}
  \label{eq:hydrostatic_equilibrium}
  \dd P = - \rho g \dd z
\end{equation}
with each component obeying the ideal gas law
\begin{equation}
  \label{eq:ideal_gas_law}
  P = \rho R T
\end{equation}
where $\rho = \frac{m}{V}$ is the volumetric mass density of the air parcel.

% MC put constants in a table, not in the appendix since it is part of the necessary data. This table has headers: symbol, value, unit of measure, notes.

\subsection{Longwave radiation}
At wavelengths $\lambda \geq \SI{4}{\micro\metre}$, solar radiation has lower intensities than radiation emitted by Earth's surface and atmosphere at the same wavelengths. Moreover, it presents negligible scattering in atmosphere with respect to absorption. For these reasons longwave radiation is considered to be emitted only by Earth's surface and atmosphere.\cite[468]{ramanathan}

% MC continue with formulae.

\subsection{Shortwave radiation}
At wavelengths $\lambda < \SI{4}{\micro\metre}$, solar radiation has much greater intensity than radiation emitted from Earth's surface and atmosphere. Both scattering and absorption by gases, aerosols and clouds of atmosphere dissipates solar radiation.\cite[469]{ramanathan}

Specific intensity of solar radiation can be expressed by a differential equation whose resolution is complex even applying approximations and numerical methods.\cite[469]{ramanathan}

A lower complexity parametrisation is adopted instead, where the atmosphere is divided in a given number of layers and radiation is absorbed, scattered and reflected between each layes. Multiple reflections can occur from each layer but only one is considered in this model because successive reflections from amospheric layers have negligible intensities compared to the first one.\cite[470]{ramanathan}

% MC continue with formulae.

\subsection{Numerical approach} % MC maybe change title.
% MC convert the problem and the physical formulae into the numerical algorithms and functions to solve it.
% MC show and describe formulae.
Euler's method is used to solve the Ordinary Differential Equation (ODE) for the time-dependant temperature function.\cite[472]{ramanathan} A solution for each atmospheric layer is evaluated, hence the resulting values are triplets of temperature, altitude (i.e. proxy for the atmospheric layer) and time (i.e. simulation time). Further information on storage and plotting of data are presented in Section~\ref{sec:Plotting}.

\section{Results}
% MC explain briefly how to read a skew-T plot.
% MC show and comment obtained plots.

\subsection{Stability analysis}
% MC the equilibrium temperature profile is insensitive of the initial guess temperature profile for the time-stepping (i.e. Euler) approach.\cite[473]{ramanathan}

\section{Discussion}
% MC sum up what I did and the results compared with article TTAPS-I.
% MC if there is enough time, use the results and the comparison with TTAPS-I as model validation then gain some insights on the same results using the contemporary nuclear arsenal and compare with the modern version of TTAPS (i.e. Turco 2008, compare what is possible since it is made with a GCM).

%\section{Conclusion} % MC instead create a "Discussion and conclusion" section.

\newpage
\appendix

\section{Source code}
In this section the \cpp\ code used to obtain the results presented in this work is shown and commented.
% MC show the whole source code, splitted in sections.

\subsection{Classes}
% MC show and comment the source code for the used classes.

\section{Supplementary information}

\subsection{Plotting}
\label{sec:Plotting}
Software Gnuplot is used to generate plots shown in this work. Output values from the simulation are stored in a DAT file with the following structure, line spacing between data blocks is important:
\begin{verbatim}
t[0]       P[0]       T[0][0]
...        ...        ...
t[0]       P[N_P - 1] T[0][N_P - 1]

t[1]       P[0]       T[1][0]
...        ...        ...
t[1]       P[N_P - 1] T[1][N_P - 1]

...

t[N_t - 1] P[0]       T[N_t - 1][0]
...        ...        ...
t[N_t - 1] P[N_P - 1] T[N_t - 1][N_P - 1]
\end{verbatim}
Value \verb|N_t| is not fixed a priori since it is the number of temporal steps needed to reach convergence, instead \verb|N_P| is the number of atmospheric layers.

\section{Mathematical derivations}
In this appendix mathematical derivations of some ancillary results and formulae used in the main text are explicitly shown.

\subsection{Relation between pressure and altitude}
A general result regarding planetary atmosphere is that atmospheric pressure decreases with increasing altitude. Theoretical relations which approximate this behaviour can be obtained. Hypotheses considered in Section~\ref{sec:Hypotheses and conventions} are valid.

If density is assumed constant, equation~\eqref{eq:hydrostatic_equilibrium} can be solved easily resulting in a linear dependence of pressure $P$ on altitude $z$, % MC normalize the way I refere to sections and equations.
\begin{equation}
  \label{eq:pressure_constant_density}
  P(z) = P_0 - \rho g (z - z_0)
  \quad ,
\end{equation}
where $(z_0, P_0)$ is a reference point inside the atmosphere.

If density is not constant its expression is given by the ideal gas law (cfr. equation~\eqref{eq:ideal_gas_law}) and, assuming constant temperature $T$, equation~\eqref{eq:hydrostatic_equilibrium} results in:
\begin{equation}
  \label{eq:pressure_constant_temperature}
  \begin{split}
    & \dd P = - \frac{P g}{R T} \dd z \iff \\
    \iff & \frac{\dd P}{P} = - \frac{g}{R T} \dd z \impliedby \\
    \impliedby & \ln(P') \bigg|_{P_0}^{P(z)} = - \frac{g}{R T} z' \bigg|_{z_0}^{z} \iff \\
    \iff & P(z) = P_0 \exp{\bigg( - \frac{g}{R T} (z - z_0) \bigg)}
    \quad .
  \end{split}
\end{equation}
This relation is not meaningful, since the aim of the work is to derive the non-constant temperature profile of the atmosphere. However, it can be used inside atmospheric layers where the temperature is considered constant.

A better approximation assumes non-constant density and constant lapse rate $\Gamma$, hence temperature depends linearly on altitude:
\begin{equation}
  \label{eq:constant_lapse_rate}
  \Gamma = - \frac{\dd T}{\dd z} \iff T(z) = T_0 - \Gamma (z - z_0)
  \quad .
\end{equation}
With these assumptions and the density rewritten through the ideal gas law \eqref{eq:ideal_gas_law}, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:pressure_constant_lapse_rate}
  \begin{split}
    & \dd P = - \frac{P g}{R} \frac{1}{T_0 - \Gamma (z - z_0)} \dd z \iff \\
  \end{split}
\end{equation}
% MC choose a better format for splitted equations.

% MC here thoughts on derivation 3 used with empirical technique for convective adjustment and using a piecewise constant lapse rate.

\newpage
\printbibliography[heading=bibintoc]
\end{document}
