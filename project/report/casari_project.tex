\providecommand\classoptions{}
\documentclass[a4paper,10pt,twocolumn,\classoptions]{article}

% Packages.
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[style=ieee,backend=biber]{biblatex}
\usepackage{booktabs}
%\usepackage[tableposition=top,figureposition=bottom,font=footnotesize,format=hang,subrefformat=parens]{caption}
\usepackage{chemformula}
\usepackage{derivative}
\usepackage{listings}
%\usepackage{mathtools}
%\usepackage{physics}
\input{standalone_packages.tex}
%\usepackage{subcaption}
%\usepackage{subfiles}
%\usepackage{tabularx}
%\usepackage{varioref}
\usepackage[hidelinks]{hyperref} % Load last.

% Packages settings.
\addbibresource{bibliography.bib}
%\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\graphicspath{{./figures/}}

% Customization.
\definecolor{Blue}{rgb}{0.2,0.2,0.9}
\definecolor{Green}{rgb}{0,0.6,0}
\definecolor{Gray}{rgb}{0.5,0.5,0.5}
\definecolor{Purple}{rgb}{0.58,0,0.82}
\definecolor{background}{rgb}{0.98,0.98,0.95}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{background},
  commentstyle=\color{Green},
  keywordstyle=\color{Blue},
  numberstyle=\tiny\color{Gray},
  stringstyle=\color{Purple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2
}
\lstdefinestyle{verbatim}{
  basicstyle=\ttfamily,
  columns=fullflexible,
  keepspaces=true,
  numbers=none
}

\newcommand{\cpp}{C++}
\newcommand{\zTOA}{z_\text{TOA}}
\newcommand{\PTOA}{P_\text{TOA}}

\raggedbottom

% Document.
\begin{document}
\title{Study Nuclear Winter with a radiative-convective climate model} % MC choose title.
\author{Marco Casari}
\date{\today}
\maketitle

\begin{abstract}
  % MC abstract.
\end{abstract}

% MC add if needed, probably not.
%\tableofcontents
%\newpage

\section{Introduction}
Planet Earth's climate dynamics can be studied with models of varying complexity. Radiative-convective models (RCMs) provide an intermediate complexity approach to the simulation of climate, evaluating an average atmospheric temperature profile. Temperature is averaged over all latitudes and longitudes and is a function of time and altitude. Since only one spatial dimension is used, it is addressed as 1-dimensional model. The atmosphere is modelled as a vertical column divided in parallel layers, each containing specific gases, hence presenting specific optical and physical properties.

Physical processes driving the model are radiation absorption, transmission, reflection and air convection which determine the energy exchange between layers. More complex mechanisms such horizontal heat transport are neglected.

The present work intends to study the atmospheric temperature profile averaged on the Northern Hemisphere in presence of conditions ...
% MC continue with the idea to apply the model to nuclear winter, if I am able to do that.



%\section{Materials}
% MC describe the tools used during the study. List the specifics and the references of the code.

\section{Methods}
\label{sec:Methods}
% MC explain the atmosphere model: vertical column where each layer present quantities averaged over the global atmosphere.
The RCM developed for the present work approximates the atmosphere as a vertical column divided in % MC put here the number of layers used.
plane-parallel layers. 
A bijective relation exists between altitude $z$ and pressure $P$ (cfr. section~\ref{sec:Relation between pressure and altitude}), hence they can be used interchangeably as vertical coordinates. The origin of coordinate $z$ is set at ground level and it is identified by value $z_\text{g}$ to keep generality. On the contrary, the Top-Of-Atmosphere (TOA) altitude $\zTOA$ is chosen arbitrarily. Pressure decreases with altitude from standard value $P_\text{g}$ at ground level to value $\PTOA$, which is calculated using equation~\eqref{eq:pressure_constant_temperature}. % MC this way the secondary scale given by pressure changes with time. To obtain the time changing plot I probaly need to choose which scale (i.e. choose a reference time instant) to use for the whole plot and a good choice is the one calculated when the steady state is reached.

Each layer is identified by a value of $z$ corresponding to the upper boundary of the layer and by its thickness. The corresponding values of pressure are evaluated at each time instant with equation~\eqref{eq:pressure_constant_temperature}.



\subsection{Hypotheses and conventions}
\label{sec:Hypotheses and conventions}
To simplify some calculations of radiative fluxes,
% MC there seems to be no sostantial changes if wavelength would be used in calculations, except for having values about {lambda^2} ~ 10^12 times greater. Maybe this is the real reason for using wavenumber instead of wavelenght.
the definition of wavenumber $\nu = \frac{1}{\lambda}$ is used in this work, where $\lambda$ is the wavelenght of the radiation. The electromagnetic (EM) spectrum is limited to interval $[\nu_\text{min}, \nu_\text{max}]$ and the choice of these values is discussed in section~\ref{sec:Division of the electromagnetic spectrum}.

Specific gas constant is used in thermodynamical relations, which is defined as the gas constant $R$ divided by the gas molar mass. Henceforth, specific gas constant is represented with symbol $R_m$.

Some assumptions are made on state and composition of Earth's atmosphere. Gravitational acceleration $g$ is constant. Atmospheric layers are supposed to be in hydrostatic equilibrium described by
\begin{equation}
  \label{eq:hydrostatic_equilibrium}
  \odif{P} = - \rho g \odif{z}
\end{equation}
and gaseous components obey the ideal gas law
\begin{equation}
  \label{eq:ideal_gas_law}
  P = \rho R_m T
  \quad ,
\end{equation}
where $\rho$ is the volumetric mass density of the gas.
Each layer is homogenoeus, in the sense that quantities affecting radiative calculations are not dependent on spatial position inside the layer (e.g. gas densities, attenuation coefficients $\mu$ and specific heats at constant pressure $c_P$ are constant inside the layer), and emits in both upward and downward directions as a blackbody. No chemical reactions are supposed to occur in atmosphere.
The average Earth's surface considered in the model is approximated as a planar blackbody emitting in the normal direction with temperature $T_\text{earth}$. Average Bond albedo for Earth is identified with constant $\alpha$.

Solar radiation is made by parallel rays forming an angle of incidence $\varepsilon$ with the normal of the plane-parallel atmospheric layers (i.e. zenith angle). % MC for US1976 epsilon = 45Â° = pi / 4 rad.
Sun's surface is approximated as an emitting blackbody with temperature $T_\text{sun}$. Constant value $S_0$ for total solar irradiance is used in calculations.

Solar spectral irradiance extends in the infrared (IR), visible (VIS) and ultraviolet (UV) bands, while spectral irradiance of Earth's surface is peaked in the IR band. The difference of their shapes allows the division of the spectrum at the intersection of the curves. The wavenumber of the intersection point is $\nu_\text{div}$. In this work, radiation with wavenumbers lesser than $\nu_\text{div}$ is addressed as longwave radiation, otherwise the denomination shortwave radiation is used. The two resulting spectra are treated independently and the overlap between curves is neglected. Accuracy of these approximations and value of $\nu_\text{div}$ are discussed in section~\ref{sec:Division of the electromagnetic spectrum}.

Data on constants used in this work are listed in table~\ref{tab:constants}.
\begin{table*}[h]
  \centering
  \caption{Data on constants used in the present work. The middle rule separates standard values on top from arbitrary values chosen for the present work on bottom.}
  \label{tab:constants}
  \begin{tabular}[b]{cccp{0.5\textwidth}}
    \toprule
    Symbol             & Value                  & Unit                                  & \centering Notes                                                   \tabularnewline
    \midrule
    $R$                & \num{8.31446261815324} & \unit{\joule\per\kelvin\per\mole}     & Gas constant                                                       \\
    $g$                & \num{9.80665}          & \unit{\metre\per\square\second}       & Standard gravitational acceleration of Earth                       \\
    $S_0$              & \num{1361.0}           & \unit{\watt\per\square\metre}         & Nominal total solar irradiance, from \cite{IAU}                    \\
    $R_\text{sun}$     & \num{6.957e8}          & \unit{\metre}                         & Nominal solar radius, from \cite{IAU}                              \\
    $T_\text{sun}$     & \num{5772}             & \unit{\kelvin}                        & Solar surface temperature, from \cite{IAU}                         \\
    $T_\text{earth}$   & \num{288.15}           & \unit{\kelvin}                        & Earth's surface temperature based on \cite{US1976}                 \\
    $\alpha$           & \num{0.3}              &                                       & Value compatible with various measures, cfr. \cite[1281]{albedo}   \\
    $P_\text{g}$       & \num{1.013250e5}       & \unit{\pascal}                        & Standard pressure at ground level, from \cite[2]{US1976}           \\
    $c_{P,\text{air}}$ & \num{1.004e3}          & \unit{\joule\per\kelvin\per\kilogram} & Specific heat at constant pressure of air, from \cite[16]{Catling} \\
    $z_\text{g}$       & \num{0}                & \unit{\metre}                         & Nominal ground level                                               \\
    \midrule
    $\zTOA$            & \num{55000}            & \unit{\metre}                         & Arbitrary TOA altitude                                             \\ % MC set the value I choose for z_TOA.
    $\nu_\text{min}$            & \num{100}            & \unit{\per\centi\metre}                         & Arbitrary minimum boundary for EM spectrum                                             \\
    $\nu_\text{max}$            & \num{100000}            & \unit{\per\centi\metre}                         & Arbitrary maximum boundary for EM spectrum                                             \\
    \bottomrule
  \end{tabular}
\end{table*}



\subsection{Temperature equation}
\label{sec:Temperature equation}
Intermediate layers of the atmosphere are treated as open systems where in general air parcels can move vertically, therefore temperature is determined by horizontally averaging the thermodynamic energy equation. Details on the derivation are in \cite[466]{Ramanathan}, where the equation is written in terms of volumetric power densities. The resulting differential equation describing temperature variation with time across layer $z$ is
\begin{equation}
  \label{eq:temperature_derivation}
  \pdv*{T(t,z)}{t} = -\frac{1}{\rho c_P} \odv*{q(z)}{z}
\end{equation}
where $q(z)$ is the total flux exchanged due to heat transfer, which depends on altitude $z$ also through $T(t,z)$.

The total heat flux $q(z)$ is determined by radiative transfer and atmospheric convection. The first process is described by the radiative transfer equation (RTE),
%\cite[25]{Modest}
while the second process is governed by fluid dynamics. The RTE is an integro-differential equation in five dimensions and it is not solved directly by the RCM, instead longwave and shortwave radiations are treated separately. Neither the contribution to $q(z)$ due to atmospheric convection is obtained by solving the proper fluid dynamics equations, in its place a numerical correction is adopted and is described in section~\ref{sec:Convective adjustment}.

With these considerations and using equation~\eqref{eq:hydrostatic_equilibrium} to drop the dependency on $\rho$, equation~\eqref{eq:temperature_derivation} can be rewritten as
\begin{equation}
  \label{eq:temperature_time_derivative}
  \pdv*{T(t,z)}{t} = \frac{g}{c_P} \odv*{\big( E_\text{L}(z) + E_\text{S}(z) \big)}{P}
  \quad ,
\end{equation}
where $E_\text{L}(z)$ and $E_\text{S}(z)$ are the irradiances of longwave and shortwave radiations, respectively.



\subsection{Longwave radiation}
\label{sec:Longwave radiation}
% Content in this section is elaborated on \cite[218]{primer}.
In the region $[\nu_\text{min}, \nu_\text{div}]$ the attenuation of radiation is dominated by absorption, scattering is neglected.
%\cite[468]{Ramanathan}
Absorbing species in this bandwidth are \ch{H2O} as water vapor, \ch{CO2} and trace gases like \ch{N2O}, chlorofluorocarbons (CFCs), \ch{CH4} (cfr. \cite[221]{primer}).

The longwave irradiance at altitude $z$ is given by
\begin{equation}
  \label{eq:irradiance_longwave}
  E_\text{L}(z) = \int_{\nu_\text{min}}^{\nu_\text{div}} E_\text{L}(\nu, z) \odif{\nu}
  \quad ,
\end{equation}
where $E_\text{L}(\nu, z)$ is the longwave spectral irradiance, obtained by integrating the RTE under the hypotheses in section~\ref{sec:Hypotheses and conventions}:
\begin{equation}
  \label{eq:spectral_irradiance_longwave}
  \begin{split}
    & E_\text{L}(\nu, z) = \\
    & = \pi B_\nu(\nu, T(t, 0)) \tau(\nu, 0, z) + \\
    & + \int_{z_\text{g}}^{z} \pi B_\nu(\nu, T(t, z')) \odv{\tau(\nu, z, z')}{z'} \odif{z'} + \\
    & - \int_{z}^{\zTOA} \pi B_\nu(\nu, T(t, z')) \odv{\tau(\nu, z, z')}{z'} \odif{z'}
  \end{split}
\end{equation}
with $\tau(\nu, z, z')$ spectral transmittance between altitudes $z$ and $z'$ and time $t$ acting as parameter.
In equation~\eqref{eq:spectral_irradiance_longwave} each addend corresponds to a spectral irradiance depositing energy at altitude $z$: the first one is generated by Earth's surface, the second one and the third one are the total spectral irradiances of layers beneath and above $z$, respectively.

Spectral transmittance is given by 
\begin{equation}
  \label{eq:spectral_transmittance}
  \tau(\nu, z, z') = e^{-\delta(\nu, z, z')}
  \quad ,
\end{equation}
where $\delta(\nu, z, z')$ is the spectral optical depth, which depends only on the spectral attenuation coefficient $\mu(\nu, z'')$ of the medium traversed by the radiation from altitude $z'$ to altitude $z$:
\begin{equation}
  \label{eq:spectral_optical_thickness}
  \delta(\nu, z, z') = \int_{z'}^{z} \mu(\nu, z'') \odif{z''}
  \quad .
\end{equation}

As stated by the hypotheses, the absorbing species do not interact, hence $\mu(\nu, z'')$ is simply the sum of the spectral absorption coefficients of the individual components of the medium. Moreover, the coefficient is constant with respect to spatial position due to homogeneity.



\subsection{Shortwave radiation}
\label{sec:Shortwave radiation}
% MC TTAPS-I: absorption and scattering of shortwave radiation.
At wavelengths $\lambda < \qty{4}{\micro\metre}$, solar radiation has much greater intensity than radiation emitted from Earth's surface and atmosphere. Both scattering and absorption by gases, aerosols and clouds of atmosphere dissipates solar radiation.
%\cite[469]{Ramanathan}
% MC solar diffuse radiant flux is neglected, hence transmittances are characterised only by the component of solar radiation normal to the layers.
% MC insert the dependence on incidence angle (only for solar radiation, i.e. divide dz by -cos(epsilon)).

Specific intensity of solar radiation can be expressed by a differential equation whose resolution is complex even applying approximations and numerical methods
%\cite[469]{Ramanathan}

A lower complexity parametrisation is adopted instead, where the atmosphere is divided in a given number of layers and radiation is absorbed, scattered and reflected between each layer. Multiple reflections can occur but only one is considered in this model because successive reflections from amospheric layers have negligible intensities compared to the first one.
%\cite[470]{Ramanathan}

% MC continue with formulae.



\subsection{Numerical resolution}
\label{sec:Numerical resolution}
% MC convert the problem and the physical formulae into the numerical algorithms and functions to solve it.
% MC show and describe formulae.
% MC explain that the integration scheme is explicit since the evaulation is made at the same time step, not at the next time step. Probably it is better if the evaluation of fluxed is made implicitly to guarantee numerical stability.

Euler's method is used to solve the Ordinary Differential Equation (ODE) for the time-dependant temperature function.
%\cite[472]{Ramanathan}
A solution for each atmospheric layer is calculated, hence the resulting values are triplets of temperature, altitude (i.e. proxy for the atmospheric layer) and time (i.e. simulation time). Further information on storage and plotting of data are presented in Section~\ref{sec:Plotting}.

% MC how many spectral bands have I chosen? Maybe list them in a table in the appendix with notes for each band to explain why I have chosen that band (e.g. to excite the vibro-rotational levels of some gases).
Spectral bands are identified by two arrays: one listing the lower bound of each band, the other containing the width of each band. This choice simplify the use of functions for numerical integration. Values related to spectral bands are stored as integers.

Layers are numbered downward starting from 0 at the TOA layer.

Equation~\eqref{eq:temperature_time_derivative} is solved in the time domain through Euler method. % MC and in space domain? Both are finite differences.

% MC I use band-averaging techniques, cfr. \cite[220]{primer}.



\subsection{Convective adjustment}
\label{sec:Convective adjustment}
% MC explain how the convective heat flux is not evaluated explicitly but it is forced by a fixed lapse rate, refer to \cite[467]{Ramanathan}.



\section{Results}
% MC explain briefly how to read a skew-T plot.
% MC show and comment obtained plots.



\subsection{Stability analysis}
% MC the equilibrium temperature profile is insensitive of the initial guess temperature profile for the time-stepping (i.e. Euler) approach.
%\cite[473]{Ramanathan}



\section{Discussion}
% MC sum up what I did and the results compared with article TTAPS-I.
% MC if there is enough time, use the results and the comparison with TTAPS-I as model validation then gain some insights on the same results using the contemporary nuclear arsenal and compare with the modern version of TTAPS (i.e. Turco 2008, compare what is possible since it is made with a GCM).



\subsection{Division of the electromagnetic spectrum}
\label{sec:Division of the electromagnetic spectrum}
% Content of this section is elaborated on \cite[43]{Catling}.
Spectral irradiances of Sun's and Earth's surfaces are obtained from blackbody spectral radiance (cfr. appendix~\ref{sec:Radiometric quantities}). They are compared inside Earth's atmosphere, whose thickness is neglected with respect to the other spatial quantities involved in these calculations, hence the comparison is performed directly on Earth's surface. Nevertheless, the reflexion of solar radiation by atmospheric components is still considered and it is parametrised through Earth's Bond albedo. Moreover, attenuation of solar radiation due to distance is considered: given a generic coordinate system, spectral radiant intensity of Sun is obtained by multiplying the spectral radiance by the area of a spherical surface with radius $R_\text{sun}$, then the result is divided by the area of a spherical surface with radius \qty{1}{\astronomicalunit} to measure solar radiance at Earth's surface.

The resulting solar spectral irradiance is
\begin{equation}
  \label{eq:spectral_irradiance_sun}
  E_\text{sun}(\nu) = (1 - \alpha) \left( \frac{R_\text{sun}}{\qty{1}{\astronomicalunit}} \right)^2 \pi B_\nu(\nu, T_\text{sun})
  \quad ,
\end{equation}
while Earth's surface spectral irradiance is
\begin{equation}
  \label{eq:spectral_irradiance_earth}
  E_\text{earth}(\nu) = \pi B_\nu(\nu, T_\text{earth})
  \quad .
\end{equation}

The boundaries of the EM spectrum are chosen arbitrarily in such a way that equations~\eqref{eq:spectral_irradiance_sun} and \eqref{eq:spectral_irradiance_earth} integrated in the resulting interval are over \qty{99}{\percent} of the respective radiant exitances (cf. appendix~\ref{sec:Radiometric quantities}) given by the Stefan-Boltzmann law
\begin{equation}
  \label{eq:stefan-boltzmann_law}
  M(T) = \sigma T^4
\end{equation}
where $\sigma$ is the Stefan-Boltzmann constant and $T$ is the temperature of the emitting body. The chosen values are shown in table~\ref{tab:constants}.

Figure~\ref{fig:spectral_irradiance} shows the plots of equations~\eqref{eq:spectral_irradiance_sun} and \eqref{eq:spectral_irradiance_earth} and the division of the spectrum at the wavenumber $\nu_\text{div}$ where the curves intersect. Value $\nu_\text{div} \approx \qty{2154}{\per\centi\metre}$ is obtained numerically (cfr. appendix~\ref{sec:Hypotheses}).
\begin{figure*}[h]
  \centering
  \includegraphics*[keepaspectratio=true,width=0.95\textwidth]{spectral_irradiance_bands}
  \caption{The vertical black line marks the division of the spectrum at $\nu_\text{div}$. In the longwave region $[\nu_\text{min}, \nu_\text{div}]$ Earth's surface brings the largest contribution to the total irradiance, in the shortwave region $[\nu_\text{div}, \nu_\text{max}]$ solar radiation dominates instead. Infrared (IR), visible (VIS) and ultraviolet (UV) spectral bands as specified by \cite{CIE} are shown in background.}
  \label{fig:spectral_irradiance}
\end{figure*}

Considering only interval $[\nu_\text{min}, \nu_\text{div}]$, the largest contribution to the total irradiance is brought by Earth's surface and solar irradiance is neglected, being about \qty{1.6}{\percent} of the total irradiance. The removed irradiance is \qty{0.65}{\percent} of the total Sun's surface irradiance. % MC talk about uncertainties?
Instead, in $[\nu_\text{div}, \nu_\text{max}]$ Earth's surface irradiance is \qty{0.22}{\percent} of the total irradiance in this interval and is neglected. The removed quantity is \qty{0.55}{\percent} of the total Earth's surface irradiance. % MC talk about uncertainties?



%\section{Conclusion} % MC instead create a "Discussion and conclusion" section.

\newpage
\appendix

\section{Source code}
In this section the \cpp\ code used to obtain the results presented in this work is shown and commented.
% MC show the whole source code, splitted in sections.

% MC some thoughts about the development of the code.
First, the parametrization of the vertical coordinate is chosen among three alternatives: altitude $z$ in \unit{\metre}, atmospheric pressure $P$ in \unit{\pascal}, coordinate $\sigma = \frac{P - \PTOA}{P_S - \PTOA}$ adimensional, with $\PTOA$ pressure at the top of the modelised atmosphere and $P_S$ pressure at the surface. One parametrisation can be written in term of another through a monotonic function (e.g. pressure decreases with altitude, cfr. Appendix~\ref{sec:Relation between pressure and altitude}). For the initial development the altitude $z$ is chosen as vertical coordinate because it is more intuitive, moreover plots in TTAPS-I are expressed in terms of both $z$ and $P$.

Second, the atmospheric layers are configured. In TTAPS-I 20 layers are used (cfr. \cite[396]{NuclearWinterPhysics}) and they are numbered from the top of the atmosphere down as it is common in RCMs. The vertical coordinate refers to the center of each layer, with the excpetion of the last layer which is in direct contact with the surface and needs to be treated separately. % MC "Temperatures are calculated at the midpoints of the layers, and fluxes are computed at the layer boundaries."\cite[449]{Catling}
Therefore two arrays are needed: one for the point and one with the corresponding layer thicknesses. Values are then assigned as double precision numbers. The value corresponding to the top of the atmosphere is set in a proper variable and a uniform distribution of layer thicknesses is assumed for ease.

% MC radiative fluxes are computed for each atmospheric layer.
To reduce the computation load of radiative fluxes, only some spectral intervals are considered and they are specific to each atmospheric layer, since the available absorbing gases and aerosols differ among layers. First absorbers for each layer are stored in an array, then the spectral bandwitdhs needed for each layer are evaluated. Spectral bandwidths are expressed in terms of wavenumbers with unit \unit{\per\centi\metre} to manage integer values or double precision values close to unity. For each chemical species the absorption intervals are identified by their width and central wavenumber, the former are obtained from the latter and using the exponential wide band model (cfr. \cite[360]{Modest}). These two values are stored in separate arrays.



\subsection{Hypotheses} % MC find a more significant title.
\label{sec:Hypotheses}
% MC here insert code and discuss details (e.g. root finder used and why) from hypotheses.cpp.



\subsection{Classes}
% MC show and comment the source code for the used classes.



\section{Mathematical derivations}
In this appendix mathematical derivations of some ancillary results and formulae used in the main text are explicitly shown.



\subsection{Relation between pressure and altitude}
\label{sec:Relation between pressure and altitude}
A general result regarding planetary atmosphere is that atmospheric pressure decreases with increasing altitude. Theoretical relations which approximate this behaviour can be obtained. Hypotheses considered in Section~\ref{sec:Hypotheses and conventions} are valid.

If density is assumed constant, equation~\eqref{eq:hydrostatic_equilibrium} can be solved easily resulting in a linear dependence of pressure $P$ on altitude $z$, % MC normalize the way I refere to sections and equations.
\begin{equation}
  \label{eq:pressure_constant_density}
  P(z) = P_0 - \rho g (z - z_0)
  \quad ,
\end{equation}
where $(z_0, P_0)$ is a reference point inside the atmosphere.

If density is not constant its expression is given by the ideal gas law (cfr. equation~\eqref{eq:ideal_gas_law}) and, assuming constant temperature $T$, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:hydrostatic_equilibrium_ideal_gas_law_constant_temperature}
  \begin{split}
    & \odif{P} = - \frac{P g}{R_m T} \odif{z} \iff \\
    \iff & \frac{\odif{P}}{P} = - \frac{g}{R_m T} \odif{z}
  \end{split}
\end{equation}
with solution
\begin{equation}
  \label{eq:pressure_constant_temperature}
  \begin{split}
    & \ln(P') \bigg|_{P_0}^{P(z)} = - \frac{g}{R_m T} z' \bigg|_{z_0}^{z} \iff \\
    \iff & P(z) = P_0 \exp{\bigg( - \frac{g}{R_m T} (z - z_0) \bigg)}
    \quad .
  \end{split}
\end{equation}
This relation is not meaningful, since the aim of the work is to derive the non-constant temperature profile of the atmosphere. However, it can be used inside atmospheric layers where the temperature is considered constant (e.g. stratosphere).

A better approximation assumes non-constant density and constant lapse rate $\Gamma$, hence temperature depends linearly on altitude,
\begin{equation}
  \label{eq:constant_lapse_rate}
  \Gamma = - \frac{\odif{T}}{\odif{z}} \impliedby T(z) = T_0 - \Gamma (z - z_0)
  \quad ,
\end{equation}
with $T_0$ temperature corresponding to reference altitude $z_0$. Using these assumptions and the density rewritten through the ideal gas law \eqref{eq:ideal_gas_law}, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:hydrostatic_equilibrium_ideal_gas_law_constant_lapse_rate}
  \begin{split}
    & \odif{P} = - \frac{P g}{R_m T} \bigg( - \frac{\odif{T}}{\Gamma} \bigg) \iff \\
    \iff & \frac{\odif{P}}{P} = \frac{g}{R_m \Gamma} \frac{\odif{T}}{T}
    \quad ,
  \end{split}
\end{equation}
which has solution
\begin{equation}
  \label{eq:pressure_constant_lapse_rate}
  \begin{split}
    & \ln(P') \bigg|_{P_0}^{P(z)} = \frac{g}{R_m \Gamma} \ln(T') \bigg|_{T_0}^{T(z)} \iff \\
    \iff & P(z) = P_0 \bigg( \frac{T_0 - \Gamma (z - z_0)}{T_0} \bigg)^\frac{g}{R_m \Gamma}
    \quad .
  \end{split}
\end{equation}

Equation \eqref{eq:pressure_constant_lapse_rate} can be used also with a piecewise constant lapse rate in altitude intervals where it is not null. Otherwise, in altitude intervals where lapse rate is null, equation \eqref{eq:pressure_constant_temperature} is valid with appropriate boundary conditions to ensure continuity between layers.



\subsection{Radiometric quantities}
\label{sec:Radiometric quantities}
Refer to \cite{CIE} for more details on quantities reviewed in this section.

Consider electromagnetic radiation emitted by a point source. The total emitted power is called \emph{radiant flux}, with unit \unit{\watt}. The density of radiant flux with respect to a solid angle in the direction of emission is called \emph{radiant intensity}, expressed in \unit{\watt\per\steradian}. When radiation interacts with a surface, i.e. it gets absorbed, transmitted or reflected, its radiant intensity distributed over the surface is measured through \emph{radiance} in \unit{\watt\per\square\metre\per\steradian}. If the area on which the radiation is incident is expressed through the solid angle it subtends, the integral of radiance over this solid angle is called \emph{irradiance}, expressed in \unit{\watt\per\square\metre}. Note that the coordinate system where the solid angles of radiant intensity and irradiance are defined may not be the same. Radiant flux emitted by a body normalised over the surface of emission is measured by \emph{radiant exitance} in \unit{\watt\per\square\metre}.

% MC if needed make a consideration for the case where there is no source and only the radiation incident on a surface is considered. This phenomenon is addressed as diffusion.

All previous quantities can be expressed as densities with respect to the wavelength or the wavenumber and the adjective \emph{spectral} is prefixed to their names. Their units are divided by the respective spectral quantity (e.g. spectral radiance with wavenumber in \unit{\per\centi\metre} has units \unit{\watt\per\metre\squared\centi\metre\per\steradian}).

Spectral radiance of a blackbody is given by Planck's law
\begin{equation}
  \label{eq:spectral_radiance_blackbody}
  B_\nu (\nu, T) = 2 h c^2 \nu^3 \frac{1}{e^\frac{h c \nu}{k_B T} - 1}
  \quad ,
\end{equation}
where $\nu$ is the wavenumber in unit \unit{\per\centi\metre} (cfr. notation in section~\ref{sec:Hypotheses and conventions}), $T$ in unit \unit{\kelvin} is the temperature of the emitting body and the other quantities are constants (cfr. table~\ref{tab:constants}).
Note that Planck's law has different form when it is expressed in terms of wavelength, due to its definition as density and the resulting change of variables:
\begin{equation}
  \label{eq:spectral_radiance_blackbody_lambda}
  B_\lambda (\lambda, T) = \frac{2 h c^2}{\lambda^5} \frac{1}{e^\frac{h c}{\lambda k_B T} - 1}
  \quad .
\end{equation}

If radiance is isotropic, i.e. it is not dependent on the direction of the radiation, the corresponding irradiance is proportional. For instance, if the radiation is absorbed by a hemispheric surface approximated by a blackbody, the spectral irradiance of the surface is
\begin{equation}
  \label{eq:spectral_irradiance_blackbody_hemisphere}
  \begin{split}
    & \int B_\nu (\nu, T) \odif{\phi} \sin(\theta) \odif{\theta} \cos(\theta) = \\
    & = B_\nu (\nu, T) \int_0^{2\pi} \odif{\phi} \int_0^\frac{\pi}{2} \sin(\theta) \cos(\theta) \odif{\theta} = \\
    & = 2 \pi B_\nu (\nu, T) \int_0^1 \sin(\theta) \odif{(\sin(\theta))} = \\
    & = 2 \pi B_\nu (\nu, T) \frac{1}{2} = \\
    & = \pi B_\nu (\nu, T)
    \quad ,
  \end{split}
\end{equation}
where spherical coordinates are used to describe the surface and the term $\cos(\theta)$ considers the component of radiation along the normal of the infinitesimal solid angle.



\subsection{Radiation attenuation}
\label{sec:Radiation attenuation}
Radiation crossing a medium loses energy due to absorption and scattering. This attenuation is measured by the \emph{transmittance} of the medium as the spectral radiant fluxes ratio of transmitted to incident radiation.

% MC continue in parallel to explanation in main text.
Experimentally it is observed that the ratio between follows the Beer-Lambert-Bouguer law
\begin{equation}
  \label{eq:extinction_law}
  E(s) = E(0) \int_0^s \dots
\end{equation}

between radiation and  of radiant flux along the direction of radiation is given by the \emph{attenuation coefficient} (commonly called \emph{extinction coefficient} in atmospheric sciences), which has different definitions based on the way it is derived (cfr. \cite[44]{Catling}). The attenuation coefficient is the sum of \emph{absorption coefficient} and \emph{scattering coefficient} which contain information on the attenuation due to the respective physical processes.
In general these coefficients are functions of wavelength or wavenumber, in which case the prefix \emph{spectral} is adopted. If the medium is a fluid, they depends on temperature and pressure of the medium.

The \emph{optical depth} (also called \emph{optical thickness}) ...



\subsection{Quantities commonly used in atmospheric sciences}
\label{sec:Quantities commonly used in atmospheric sciences}
Earth's surface horizontal profile is not uniform, hence altitude and pressure near ground level could present sudden variations. In models where this is taken into consideration, the sigma coordinate system is commonly used instead, defined by
\begin{equation}
  \label{eq:sigma_coordinate}
  \sigma = \frac{P - \PTOA}{P_\text{g} - \PTOA}
  \quad .
\end{equation}

An alternative quantity evaluated in place of $T(t,z)$ for a given parcel of fluid is the potential temperature
\begin{equation}
  \label{eq:potential_temperature}
  \theta(t,z) = T(t,z) \bigg( \frac{P_0}{P(z)} \bigg)^\frac{R_m}{c_P}
  \quad ,
\end{equation}
where $P_0$ is a reference pressure and quantities $P(z)$, $R_m$ and $c_P$ refer to the fluid.



\section{Supplementary information}



\subsection{Plotting}
\label{sec:Plotting}
Software gnuplot is used to generate plots shown in this work. Output values from the simulation are stored in a DAT file with the structure reproduced in listing~\ref{lst:file_plot}.
\begin{lstlisting}[%
  style=verbatim,%
  gobble=2,%
  float=*h,%
  caption={Structure of DAT file containing output values. The line spacing between data blocks is mandatory and ellipsis \texttt{...} indicates a logical continuation of the sequence. Number \texttt{N\_t} of temporal steps needed to reach convergence is not known a priori, instead \texttt{N} is the chosen number of atmospheric layers. Quantities \texttt{P}, \texttt{sigma} and \texttt{theta} are added in case of need for additional plots or comparison with other models.},%
  label={lst:file_plot}%
]
  t[0]       z[0]     T[0][0]           P[0]     sigma[0]     theta[0][0]
  ...        ...      ...               ...      ...          ...
  t[0]       z[N - 1] T[0][N - 1]       P[N - 1] sigma[N - 1] theta[0][N - 1]

  t[1]       z[0]     T[1][0]           P[0]     sigma[0]     theta[1][0]
  ...        ...      ...               ...      ...          ...
  t[1]       z[N - 1] T[1][N - 1]       P[N - 1] sigma[N - 1] theta[1][N - 1]

  ...

  t[N_t - 1] z[0]     T[N_t - 1][0]     P[0]     sigma[0]     theta[N_t - 1][0]
  ...        ...      ...               ...      ...          ...
  t[N_t - 1] z[N - 1] T[N_t - 1][N - 1] P[N - 1] sigma[N - 1] theta[N_t - 1][N - 1]
\end{lstlisting}



\newpage
\printbibliography[heading=bibintoc]
\end{document}
