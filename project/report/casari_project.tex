\documentclass[a4paper,10pt,final,twocolumn]{article}

% Packages.
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[style=ieee,backend=biber]{biblatex}
\usepackage{booktabs}
%\usepackage[tableposition=top,figureposition=bottom,font=footnotesize,format=hang,subrefformat=parens]{caption}
\usepackage{listings}
%\usepackage{mathtools}
%\usepackage{physics}
\input{standalone_packages.tex}
%\usepackage{subcaption}
%\usepackage{subfiles}
%\usepackage{tabularx}
%\usepackage{varioref}
\usepackage[hidelinks]{hyperref} % Load last.

% Packages settings.
\addbibresource{bibliography.bib}
%\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\graphicspath{{./figures/}}

% Customization.
\definecolor{Blue}{rgb}{0.2,0.2,0.9}
\definecolor{Green}{rgb}{0,0.6,0}
\definecolor{Gray}{rgb}{0.5,0.5,0.5}
\definecolor{Purple}{rgb}{0.58,0,0.82}
\definecolor{background}{rgb}{0.98,0.98,0.95}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{background},
  commentstyle=\color{Green},
  keywordstyle=\color{Blue},
  numberstyle=\tiny\color{Gray},
  stringstyle=\color{Purple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2
}
\lstset{style=mystyle}

\newcommand{\cpp}{C++}
\newcommand{\dd}{\mathop{}\!\mathrm{d}}
\newcommand{\PTOA}{P_\text{TOA}}

\raggedbottom

% Document.
\begin{document}
\title{Study Nuclear Winter with a radiative-convective climate model} % MC choose title.
\author{Marco Casari}
\date{\today}
\maketitle

\begin{abstract}
  % MC abstract.
\end{abstract}

% MC add if needed, probably not.
%\tableofcontents
%\newpage

\section{Introduction}
Planet Earth's climate dynamics can be studied with models of varying complexity. Radiative-convective models (RCMs) provide an intermediate complexity approach to the simulation of climate, evaluating an average atmospheric temperature profile. Temperature is averaged over all latitudes and longitudes and is a function of time and altitude. Since only one spatial dimension is used, it is addressed as 1-dimensional model. The atmosphere is modelled as a vertical column divided in parallel layers, each containing specific gases, hence presenting specific optical and physical properties.

Physical processes driving the model are radiation absorption, transmission, reflection and air convection which determine the energy exchange between layers. More complex mechanisms such horizontal heat transport are neglected.

The present work intends to study the atmospheric temperature profile averaged on the Northern Hemisphere in presence of conditions ...
% MC continue with the idea to apply the model to nuclear winter, if I am able to do that.



%\section{Materials}
% MC describe the tools used during the study. List the specifics and the references of the code.

\section{Methods}
\label{sec:Methods}
% MC explain the atmosphere model: vertical column where each layer present quantities averaged over the global atmosphere.
The RCM developed for the present work approximates the atmosphere as a vertical column divided in % MC put here the number of layers used.
plane-parallel layers. Temperature is evaluated % MC continue following or replacing what is written in \ref{sec:Numerical treatment}.



\subsection{Hypotheses and conventions}
\label{sec:Hypotheses and conventions}
To simplify some calculations for radiative fluxes, the definition of wavenumber $\nu = \frac{1}{\lambda}$ is used in this work, where $\lambda$ is the wavelenght of the radiation.

Specific gas constant is used in thermodynamical relations, which is defined as the gas constant $R$ divided by the gas molar mass. Henceforth, specific gas constant is represented with symbol $R_m$.

Some assumptions are made on state and composition of Earth's atmosphere. Gravitational acceleration $g$ is constant. Air parcels are supposed to be in hydrostatic equilibrium,
\begin{equation}
  \label{eq:hydrostatic_equilibrium}
  \dd P = - \rho g \dd z
  \quad ,
\end{equation}
with each component obeying the ideal gas law
\begin{equation}
  \label{eq:ideal_gas_law}
  P = \rho R_m T
\end{equation}
where $\rho = \frac{m}{V}$ is the volumetric mass density of the air parcel. Each atmospheric layer is homogeneous, which means that quantities affecting radiative calculations are not dependent on spatial position inside the layer (e.g. gas densities and extintion coefficients are constant inside the layer).
The average Earth's surface considered in the model is approximated as an emitting blackbody with temperature $T_\text{earth}$. Average Bond albedo fo Earth is identified with constant $\alpha$.

Solar radiation is composed by parallel rays forming an angle of incidence $\epsilon$ with the plane-parallel layers of Earth's atmosphere model. Sun's surface is approximated as an emitting blackbody with temperature $T_\text{sun}$. Constant value $S_0$ for total solar irradiance is used in calculations.

Solar spectral irradiance extends in the infrared (IR), visible (VIS) and ultraviolet (UV) bandwidths, while spectral irradiance of Earth's surface is peaked in the IR bandwidth. The difference of their shapes allows the division of the spectrum at the intersection of the curves. The wavenumber of the intersection point is $\nu_\text{div}$, radiation with wavenumbers below it is called longwave radiation, otherwise it is addressed as shortwave radiation. These two spectra are treated independently and the overlap between curves is neglected. Accuracy of this approximation and value of $\nu_\text{div}$ are discussed in section~\ref{sec:Division of the electromagnetic spectrum}.

Data on constants used in this work are listed in table~\ref{tab:constants}.
\begin{table*}[h]
  \centering
  \caption{Data on constants used in the present work.}
  \label{tab:constants}
  \begin{tabular}[b]{cccc}
    \toprule
    Symbol           & Value                  & Unit                                           & Notes                                                            \\
    \midrule
    $R$              & \num{8.31446261815324} & \unit{\cubic\metre\pascal\per\kelvin\per\mole} &                                                                  \\
    $g$              & \num{9.80665}          & \unit{\metre\per\square\second}                &                                                                  \\
    $S_0$            & \num{1361.0}           & \unit{\watt\per\square\metre}                  & Nominal total solar irradiance, from \cite{IAU}                  \\
    $R_\text{sun}$   & \num{6.957e8}          & \unit{\metre}                                  & Nominal solar radius, from \cite{IAU}                            \\
    $T_\text{sun}$   & \num{5772}             & \unit{\kelvin}                                 & Solar surface temperature, from \cite{IAU}                       \\
    $T_\text{earth}$ & \num{288.15}           & \unit{\kelvin}                                 & Earth's surface temperature based on \cite{ISA}                  \\
    $\alpha$         & \num{0.3}              &                                                & Value compatible with various measures, cfr. \cite[1281]{albedo} \\
    \bottomrule
  \end{tabular}
\end{table*}



\subsection{Shortwave radiation}
% MC TTAPS-I: absorption and scattering of shortwave radiation.
At wavelengths $\lambda < \qty{4}{\micro\metre}$, solar radiation has much greater intensity than radiation emitted from Earth's surface and atmosphere. Both scattering and absorption by gases, aerosols and clouds of atmosphere dissipates solar radiation.\cite[469]{ramanathan}

Specific intensity of solar radiation can be expressed by a differential equation whose resolution is complex even applying approximations and numerical methods.\cite[469]{ramanathan}

A lower complexity parametrisation is adopted instead, where the atmosphere is divided in a given number of layers and radiation is absorbed, scattered and reflected between each layes. Multiple reflections can occur from each layer but only one is considered in this model because successive reflections from amospheric layers have negligible intensities compared to the first one.\cite[470]{ramanathan}

% MC continue with formulae.



\subsection{Longwave radiation}
% MC TTAPS-I: absorption of longwave radiation.
At wavelengths $\lambda \geq \qty{4}{\micro\metre}$, solar radiation has lower intensities than radiation emitted by Earth's surface and atmosphere at the same wavelengths. Moreover, it presents negligible scattering in atmosphere with respect to absorption. For these reasons longwave radiation is considered to be emitted only by Earth's surface and atmosphere.\cite[468]{ramanathan}

% MC continue with formulae.



\subsection{Numerical treatment} % MC find better title.
\label{sec:Numerical treatment}
% MC convert the problem and the physical formulae into the numerical algorithms and functions to solve it.
% MC show and describe formulae.
% MC explain that the integration scheme is explicit since the evaulation is made at the same time step, not at the next time step. Probably it is better if the evaluation of fluxed is made implicitly to guarantee numerical stability.

Euler's method is used to solve the Ordinary Differential Equation (ODE) for the time-dependant temperature function.\cite[472]{ramanathan} A solution for each atmospheric layer is evaluated, hence the resulting values are triplets of temperature, altitude (i.e. proxy for the atmospheric layer) and time (i.e. simulation time). Further information on storage and plotting of data are presented in Section~\ref{sec:Plotting}.

% MC how many spectral bands have I chosen? Maybe list them in a table in the appendix with notes for each band to explain why I have chosen that band (e.g. to excite the vibro-rotational levels of some gases).
Spectral bands are identified by two arrays: one listing the lower bound of each band, the other containing the width of each band. This choice simplify the use of functions for numerical integration. Values related to spectral bands are stored as integers.



\section{Results}
% MC explain briefly how to read a skew-T plot.
% MC show and comment obtained plots.



\subsection{Stability analysis}
% MC the equilibrium temperature profile is insensitive of the initial guess temperature profile for the time-stepping (i.e. Euler) approach.\cite[473]{ramanathan}



\section{Discussion}
% MC sum up what I did and the results compared with article TTAPS-I.
% MC if there is enough time, use the results and the comparison with TTAPS-I as model validation then gain some insights on the same results using the contemporary nuclear arsenal and compare with the modern version of TTAPS (i.e. Turco 2008, compare what is possible since it is made with a GCM).



\subsection{Division of the electromagnetic spectrum}
\label{sec:Division of the electromagnetic spectrum}
% Content of this section is elaborated on \cite[43]{Catling}.
Spectral irradiances of Sun and Earth's surfaces are obtained from blackbody spectral radiance (cfr. appendix~\ref{sec:Radiometric quantities}). They are compared inside Earth's atmosphere, whose thickness is neglected with respect to the other spatial quantities involved in these calculations, hence the comparison is performed directly on Earth's surface. Given a generic coordinate system, attenuation of solar radiation is considered: spectral radiant intensity of Sun is obtained by multiplying the spectral radiance by the area of a spherical surface with radius $R_\text{sun}$, then the result is divided by the area of a spherical surface with radius \qty{1}{\astronomicalunit} to measure solar radiance at Earth's surface. The resulting solar spectral irradiance is
\begin{equation}
  \label{eq:spectral_irradiance_sun}
  E_\text{sun}(\nu) = (1 - \alpha) \left( \frac{R_\text{sun}}{\qty{1}{\astronomicalunit}} \right)^2 \pi B_\nu(\nu, T_\text{sun})
  \quad ,
\end{equation}
while Earth's surface spectral irradiance is
\begin{equation}
  \label{eq:spectral_irradiance_earth}
  E_\text{earth}(\nu) = \pi B_\nu(\nu, T_\text{earth})
  \quad .
\end{equation}

Figure~\ref{fig:spectral_irradiance} shows the plots of equations~\eqref{eq:spectral_irradiance_sun} and \eqref{eq:spectral_irradiance_earth} and the division of the spectrum at the wavenumber $\nu_\text{div}$ where the curves intersect. Value $\nu_\text{div} \approx \qty{2154}{\per\centi\metre}$ is obtained numerically (cfr. appendix~\ref{sec:Hypotheses}).
\begin{figure*}[h]
  \centering
  \includegraphics*[keepaspectratio=true,width=0.95\textwidth]{spectral_irradiance_bands}
  \caption{The vertical black line marks the division of the spectrum at $\nu_\text{div}$. In the longwave region $[\qty{100}{\per\centi\metre}, \nu_\text{div}]$ Earth's surface brings the largest contribution to the total irradiance, in the shortwave region $[\nu_\text{div}, \qty{100000}{\per\centi\metre}]$ solar radiation dominates instead. Infrared (IR), visible (VIS) and ultraviolet (UV) spectral bands as specified by \cite{CIE} are shown in background.}
  \label{fig:spectral_irradiance}
\end{figure*}

Considering only interval $[\qty{100}{\per\centi\metre}, \nu_\text{div}]$, the largest contribution to the total irradiance is brought by Earth's surface and solar irradiance is neglected, being about \qty{2.2}{\percent} of the total irradiance. The removed irradiance is \qty{0.65}{\percent} of the total Sun's surface irradiance. % MC talk about uncertainties?
Instead, in $[\nu_\text{div}, \qty{100000}{\per\centi\metre}]$ Earth's surface irradiance is \qty{0.16}{\percent} of the total irradiance in this interval and is neglected. The removed quantity is \qty{0.55}{\percent} of the total Earth's surface irradiance. % MC talk about uncertainties?



%\section{Conclusion} % MC instead create a "Discussion and conclusion" section.

\newpage
\appendix

\section{Source code}
In this section the \cpp\ code used to obtain the results presented in this work is shown and commented.
% MC show the whole source code, splitted in sections.

% MC some thoughts about the development of the code.
First, the parametrization of the vertical coordinate is chosen among three alternatives: altitude $z$ in \unit{\metre}, atmospheric pressure $P$ in \unit{\pascal}, coordinate $\sigma = \frac{P - \PTOA}{P_S - \PTOA}$ adimensional, with $\PTOA$ pressure at the top of the modelised atmosphere and $P_S$ pressure at the surface. One parametrisation can be written in term of another through a monotonic function (e.g. pressure decreases with altitude, cfr. Appendix~\ref{sec:Relation between pressure and altitude}). For the initial development the altitude $z$ is chosen as vertical coordinate because it is more intuitive, moreover plots in TTAPS-I are expressed in terms of both $z$ and $P$.

Second, the atmospheric layers are configured. In TTAPS-I 20 layers are used (cfr. \cite[396]{NuclearWinterPhysics}) and they are numbered from the top of the atmosphere down as it is common in RCMs. The vertical coordinate refers to the center of each layer, with the excpetion of the last layer which is in direct contact with the surface and needs to be treated separately. % MC "Temperatures are calculated at the midpoints of the layers, and fluxes are computed at the layer boundaries."\cite[449]{Catling}
Therefore two arrays are needed: one for the point and one with the corresponding layer thicknesses. Values are then assigned as double precision numbers. The value corresponding to the top of the atmosphere is set in a proper variable and a uniform distribution of layer thicknesses is assumed for ease.

% MC radiative fluxes are computed for each atmospheric layer.
To reduce the computation load of radiative fluxes, only some spectral intervals are considered and they are specific to each atmospheric layer, since the available absorbing gases and aerosols differ among layers. First absorbers for each layer are stored in an array, then the spectral bandwitdhs needed for each layer are evaluated. Spectral bandwidths are expressed in terms of wavenumbers with unit \unit{\per\centi\metre} to manage integer values or double precision values close to unity. For each chemical species the absorption intervals are identified by their width and central wavenumber, the former are obtained from the latter and using the exponential wide band model (cfr. \cite[360]{Modest}). These two values are stored in separate arrays.



\subsection{Hypotheses} % MC find a more significant title.
\label{sec:Hypotheses}
% MC here insert code and discuss details (e.g. root finder used and why) from hypotheses.cpp.



\subsection{Classes}
% MC show and comment the source code for the used classes.



\section{Supplementary information}



\subsection{Plotting}
\label{sec:Plotting}
Software Gnuplot is used to generate plots shown in this work. Output values from the simulation are stored in a DAT file with the following structure, line spacing between data blocks is important:
\begin{verbatim}
t[0]       P[0]       T[0][0]
...        ...        ...
t[0]       P[N_P - 1] T[0][N_P - 1]

t[1]       P[0]       T[1][0]
...        ...        ...
t[1]       P[N_P - 1] T[1][N_P - 1]

...

t[N_t - 1] P[0]       T[N_t - 1][0]
...        ...        ...
t[N_t - 1] P[N_P - 1] T[N_t - 1][N_P - 1]
\end{verbatim}
Value \verb|N_t| is not known a priori since it is the number of temporal steps needed to reach convergence, instead \verb|N_P| is the chosen number of atmospheric layers.



\section{Mathematical derivations}
In this appendix mathematical derivations of some ancillary results and formulae used in the main text are explicitly shown.



\subsection{Relation between pressure and altitude}
\label{sec:Relation between pressure and altitude}
A general result regarding planetary atmosphere is that atmospheric pressure decreases with increasing altitude. Theoretical relations which approximate this behaviour can be obtained. Hypotheses considered in Section~\ref{sec:Hypotheses and conventions} are valid.

If density is assumed constant, equation~\eqref{eq:hydrostatic_equilibrium} can be solved easily resulting in a linear dependence of pressure $P$ on altitude $z$, % MC normalize the way I refere to sections and equations.
\begin{equation}
  \label{eq:pressure_constant_density}
  P(z) = P_0 - \rho g (z - z_0)
  \quad ,
\end{equation}
where $(z_0, P_0)$ is a reference point inside the atmosphere.

If density is not constant its expression is given by the ideal gas law (cfr. equation~\eqref{eq:ideal_gas_law}) and, assuming constant temperature $T$, equation~\eqref{eq:hydrostatic_equilibrium} results in:
\begin{equation}
  \label{eq:pressure_constant_temperature}
  \begin{split}
    & \dd P = - \frac{P g}{R T} \dd z \iff \\
    \iff & \frac{\dd P}{P} = - \frac{g}{R T} \dd z \impliedby \\
    \impliedby & \ln(P') \bigg|_{P_0}^{P(z)} = - \frac{g}{R T} z' \bigg|_{z_0}^{z} \iff \\
    \iff & P(z) = P_0 \exp{\bigg( - \frac{g}{R T} (z - z_0) \bigg)}
    \quad .
  \end{split}
\end{equation}
This relation is not meaningful, since the aim of the work is to derive the non-constant temperature profile of the atmosphere. However, it can be used inside atmospheric layers where the temperature is considered constant (e.g. stratosphere).

A better approximation assumes non-constant density and constant lapse rate $\Gamma$, hence temperature depends linearly on altitude,
\begin{equation}
  \label{eq:constant_lapse_rate}
  \Gamma = - \frac{\dd T}{\dd z} \impliedby T(z) = T_0 - \Gamma (z - z_0)
  \quad ,
\end{equation}
with $T_0$ temperature corresponding to reference altitude $z_0$. Using these assumptions and the density rewritten through the ideal gas law \eqref{eq:ideal_gas_law}, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:pressure_constant_lapse_rate}
  \begin{split}
    & \dd P = - \frac{P g}{R T} \bigg( - \frac{\dd T}{\Gamma} \bigg) \iff \\
    \iff & \frac{\dd P}{P} = \frac{g}{R \Gamma} \frac{\dd T}{T} \impliedby \\
    \impliedby & \ln(P') \bigg|_{P_0}^{P(z)} = \frac{g}{R \Gamma} \ln(T') \bigg|_{T_0}^{T(z)} \iff \\
    \iff & P(z) = P_0 \bigg( \frac{T_0 - \Gamma (z - z_0)}{T_0} \bigg)^\frac{g}{R \Gamma}
  \end{split}
\end{equation}
% MC choose a better format for splitted equations.

Equation \eqref{eq:pressure_constant_lapse_rate} can be used also with a piecewise constant lapse rate in altitude intervals where it is not null. Otherwise, in altitude intervals where lapse rate is null, equation \eqref{eq:pressure_constant_temperature} is valid with appropriate boundary conditions to ensure continuity between layers.



\subsection{Radiometric quantities}
\label{sec:Radiometric quantities}
Refer to \cite{CIE} for more details on quantities reviewed in this section.

Consider electromagnetic radiation emitted by a point source. The total emitted power is called \emph{radiant flux}, with unit \unit{\watt}. The density of radiant flux with respect to a solid angle in the direction of emission is called \emph{radiant intensity}, expressed in \unit{\watt\per\steradian}. When radiation interacts with a surface, i.e. it gets absorbed, transmitted or reflected, its radiant intensity distributed over the surface is measured through \emph{radiance} in \unit{\watt\per\square\metre\per\steradian}. If the area on which the radiation is incident is expressed through the solid angle it subtends, the integral of radiance over this solid angle is called \emph{irradiance}, expressed in \unit{\watt\per\square\metre}. Note that the coordinate system where the solid angles of radiant intensity and irradiance are defined may not be the same.

% MC if needed make a consideration for the case where there is no source and only the radiation incident on a surface is considered.

All previous quantities can be expressed as densities with respect to the wavelength or the wavenumber and the adjective \emph{spectral} is prefixed to their names. Their units are divided by the respective spectral quantity (e.g. spectral radiance with wavenumber in \unit{\per\centi\metre} has units \unit{\watt\per\metre\squared\centi\metre\per\steradian}).

Spectral radiance of a blackbody is given by Planck's law
\begin{equation}
  \label{eq:blackbody_spectral_radiance}
  B_\nu (\nu, T) = 2 h c^2 \nu^3 \frac{1}{e^\frac{h c \nu}{k_B T} - 1}
  \quad ,
\end{equation}
where $\nu$ is the wavenumber in unit \unit{\per\centi\metre} (cfr. notation in section~\ref{sec:Hypotheses and conventions}), $T$ in unit \unit{\kelvin} is the temperature of the emitting body and the other quantities are constants (cfr. table~\ref{tab:constants}).
Note that Planck's law has different form when it is expressed in terms of wavelength, due to its definition as density and the resulting change of variables:
\begin{equation}
  \label{eq:blackbody_spectral_radiance_lambda}
  B_\lambda (\lambda, T) = \frac{2 h c^2}{\lambda^5} \frac{1}{e^\frac{h c}{\lambda k_B T} - 1}
  \quad .
\end{equation}

If radiance is isotropic, i.e. it has not dependence on the direction of the radiation, the corresponding irradiance is proportional. For instance, if the radiation is absorbed by a hemispheric surface approximated by a blackbody, the spectral irradiance of the surface is
\begin{equation}
  \label{eq:blackbody_spectral_irradiance_hemisphere}
  \begin{split}
    & \int B_\nu (\nu, T) \dd \phi \sin(\theta) \dd \theta \cos(\theta) = \\
    & = B_\nu (\nu, T) \int_0^{2\pi} \dd \phi \int_0^\frac{\pi}{2} \sin(\theta) \cos(\theta) \dd \theta = \\
    & = 2 \pi B_\nu (\nu, T) \int_0^1 \sin(\theta) \dd(\sin(\theta)) = \\
    & = 2 \pi B_\nu (\nu, T) \frac{1}{2} = \pi B_\nu (\nu, T)
  \end{split}
  \quad ,
\end{equation}
where spherical coordinates are used to describe the surface and the term $\cos(\theta)$ considers the component of radiation along the normal of the infinitesimal solid angle.



\newpage
\printbibliography[heading=bibintoc]
\end{document}
