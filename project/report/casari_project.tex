\providecommand\classoptions{}
\documentclass[a4paper,10pt,twocolumn,\classoptions]{article}

% Packages.
\usepackage[T1]{fontenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[style=ieee,backend=biber]{biblatex}
\usepackage{booktabs}
%\usepackage[tableposition=top,figureposition=bottom,font=footnotesize,format=hang,subrefformat=parens]{caption}
\usepackage{chemformula}
\usepackage{derivative}
\usepackage{listings}
%\usepackage{mathtools}
%\usepackage{physics}
\input{standalone_packages.tex}
%\usepackage{subcaption}
%\usepackage{subfiles}
%\usepackage{tabularx}
%\usepackage{varioref}
\usepackage[hidelinks]{hyperref} % Load last.

% Packages settings.
\addbibresource{bibliography.bib}
%\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\graphicspath{{./figures/}}

% Customization.
\definecolor{Blue}{rgb}{0.2,0.2,0.9}
\definecolor{Green}{rgb}{0,0.6,0}
\definecolor{Gray}{rgb}{0.5,0.5,0.5}
\definecolor{Purple}{rgb}{0.58,0,0.82}
\definecolor{background}{rgb}{0.98,0.98,0.95}
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{background},
  commentstyle=\color{Green},
  keywordstyle=\color{Blue},
  numberstyle=\tiny\color{Gray},
  stringstyle=\color{Purple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2
}
\lstdefinestyle{verbatim}{
  basicstyle=\ttfamily,
  columns=fullflexible,
  keepspaces=true,
  numbers=none
}

\newcommand{\cpp}{C++}
\newcommand{\zTOA}{z_\text{TOA}}
\newcommand{\PTOA}{P_\text{TOA}}
\newcommand{\deltaTOA}{\delta_\text{TOA}}

\raggedbottom

% Document.
\begin{document}
\title{Radiative-convective equilibrium in a grey atmosphere}
\author{Marco Casari}
\date{\today}
\maketitle

\begin{abstract}
  Radiative-convective models provide an intermediate complexity approach to the simulation of climate. These models evaluate the atmospheric temperature profile averaged over all latitudes and longitudes, which is function of time and altitude.
  Physical processes which determine the energy exchange in the model are absorption, transmission, reflection of electromagnetic radiation and convection of fluid.
  In this work a radiative-convective model is used to derive the temperature of an atmosphere where the optical depth is constant with respect to the frequency of radiation. The resulting temperature profile is compared with the analytical solution provided under the condition of radiative equilibrium.
\end{abstract}

% MC remove when finished.
%\tableofcontents
%\newpage

\section{Introduction}
\label{sec:Introduction}
Climate dynamics can be studied with models of varying complexity. One of the quantities analysed is the temporal and spatial distribution of temperature in the atmosphere, which is the result of the heat exchange between different processes. Electromagnetic (EM) radiation is emitted, absorbed and scattered by the chemical species distributed in the atmosphere and by the planetary surface. Moreover, the atmosphere receives EM radiation by other celestial bodies, e.g. stars. Radiative processes are described by the Radiative Transfer Equation (RTE).
%\cite[25]{Modest}
Local temperature differences generate motion of fluid parcels, hence convection. A rough planetary surface can hinder horizontal heat transport. Fluid dynamics equations are needed to represent these processes.

Fluid parcels are treated as open systems and the temperature distribution is obtained by a suitable thermodynamic energy equation, coupled with the equations of the processes occuring in the atmosphere. Even by limiting the analysis to radiative processes and convection, which are the main drivers of temperature variations, the equations involved are not solvable analytically and are not tractable numerically without simplifications.

A first approximation is to consider the average over all latitudes and longitudes for quantities which depend on spatial position. The resulting atmosphere is represented by plane-parallel layers, identified by their altitude $z$ ranging from $z_\text{g}$ at ground level to $\zTOA$ at the Top Of the Atmosphere (TOA). With this hypothesis, the differential equation describing temperature variation with respect to time $t$ is
\begin{equation}
  \label{eq:temperature_derivation}
  \pdv*{T(t,z)}{t} = -\frac{1}{\varrho c_P} \odv*{q(z)}{z}
  \quad ,
\end{equation}
where $\varrho$ is the volumetric mass density of the atmosphere, in general a function of $z$, $c_P$ is the specific heat at constant pressure of the atmosphere, assumed constant, and $q(z)$ is the total flux exchanged due to heat transfer, which depends on altitude $z$ also through $T(t,z)$. Details on the derivation are in \cite[466]{Ramanathan}, where the equation is written initially in terms of volumetric power densities.

A second hypothesis is the radiative-convective equilibrium of the atmosphere. This translates in the existence of a steady state $\pdv*{T(t,z)}{t} = 0$ where the atmosphere is both in radiative equilibrium, i.e. the total radiant flux at TOA is null, and in convective equilibrium, i.e. fluid parcels are stable with respect to vertical motion.

A model with the previous assumptions is called Radiative-Convective Model (RCM).
To simplify further the RTE, in this work the dependence of optical depth $\delta$ on the frequency of EM radiation is neglected. An atmosphere with this property is called grey atmosphere.

Additional hypotheses are considered to simplify this study.
Specific gas constant $R_m$ is used in thermodynamic relations, which is defined as the gas constant $R$ divided by the molar mass of the gas.
Gravitational acceleration $g$ is constant.
The atmosphere is supposed to be in hydrostatic equilibrium described by
\begin{equation}
  \label{eq:hydrostatic_equilibrium}
  \odif{P} = - \varrho g \odif{z}
\end{equation}
and to obey the ideal gas law
\begin{equation}
  \label{eq:ideal_gas_law}
  P = \varrho R_m T
  \quad .
\end{equation}
A bijective relation exists between altitude $z$ and pressure $P$ (cfr. section~\ref{sec:Relation between pressure and altitude}), hence they can be used interchangeably as vertical coordinates. Pressure decreases with altitude from standard value $P_\text{g}$ at ground level to value $\PTOA$ at TOA.
To simplify radiative calculations, scattering is neglected and optical depth is used as vertical coordinate, starting from \num{0} at TOA and increasing downward up to value $\delta_\text{g}$ at ground level. Optical depth is a function of altitude through
\begin{equation}
  \label{eq:optical_depth_altitude}
  \delta(z) = \mu_m \int_{z}^{\zTOA} \varrho(z') \odif{z'}
  \quad ,
\end{equation}
where $\mu_m$ is the mass attenuation coefficient of the atmosphere, which corresponds to the sum of mass attenuation coefficients of the chemical species if they do not interact. This coefficient can be otbained as function of $\deltaTOA$ by evaluating equation~\eqref{eq:optical_depth_altitude_2} at the ground level,
\begin{equation}
  \label{eq:mass_attenuation_coefficient}
  \frac{\delta_\text{g} g}{P_\text{g} - \PTOA}
  \quad ,
\end{equation}
or can be used as parameter to derive $\deltaTOA$. A simpler relation exists between $\delta$ and $P$ using equation~\eqref{eq:hydrostatic_equilibrium} to evaluate the integral in equation~\eqref{eq:optical_depth_altitude}:
\begin{equation}
  \label{eq:optical_depth_pressure}
  \delta(P) = \frac{\mu_m}{g} (P - \PTOA)
  \quad .
\end{equation}
Relation~\eqref{eq:optical_depth_pressure} is used also in conjunction with equation~\eqref{eq:pressure_constant_temperature} to derive another formula for optical depth as a function of altitude:
\begin{equation}
  \label{eq:optical_depth_altitude_2}
  \delta(z) = \frac{\mu_m}{g} \bigg( P_\text{g} \exp{\bigg( - \frac{z - z_\text{g}}{z_0} \bigg)} - \PTOA \bigg)
  \quad ,
\end{equation}
where ground level is chosen as reference point and constant factor $z_0$ is introduced to normalise the numerator. Note that $\PTOA$ can be calculated from a fixed $\zTOA$ using equation~\eqref{eq:pressure_constant_temperature}, or viceversa.
For simplicity, the planet is supposed to have a diurnal cycle, to receive a constant irradiance $S_0$ and to have a constant Bond albedo $A$.
Atmosphere is supposed transparent to radiation from outside the planet.

The total heat flux $q(z)$ is determined by radiative transfer and atmospheric convection. The RTE is not solved directly by the RCM, instead a two-stream approximation is adopted: radiation is split in upward and downward directions and they are treated separately. Neither the contribution to $q(z)$ due to atmospheric convection is obtained by solving the proper fluid dynamics equations, in its place a numerical correction is adopted.
With these considerations, equation~\eqref{eq:temperature_derivation} can be rewritten as
\begin{equation}
  \label{eq:temperature_time_derivative}
  \pdv*{T(t,z)}{t} = -\frac{1}{\varrho c_P} \odv*{\big( E_\text{U}(z) - E_\text{D}(z) \big)}{z}
  \quad ,
\end{equation}
where $E_\text{U}(z)$ and $E_\text{D}(z)$ are the irradiances of upward and downward radiations, respectively.

Data on constants used in this work are listed in table~\ref{tab:constants} and where possible, values referred to Earth are used for a prompt comparison with reality.
\begin{table*}[h]
  \centering
  \caption{Data on constants used in the present work. The middle rule separates standard values on top from arbitrary values chosen for the present work on bottom.}
  \label{tab:constants}
  \begin{tabular}[b]{cccp{0.5\textwidth}}
    \toprule
    Symbol             & Value                  & Unit                                  & \centering Notes                                                   \tabularnewline
    \midrule
    $A$                & \num{0.3}              &                                       & Bond albedo value compatible with various observations, cfr. \cite[1281]{albedo}   \\
    $A_\text{g}$           & \num{0.1}              &                                       & Average surface albedo of Earth, cfr. \cite[217]{primer}   \\
    $c_{P,\text{air}}$ & \num{1.004e3}          & \unit{\joule\per\kelvin\per\kilogram} & Specific heat at constant pressure of air, from \cite[16]{Catling} \\
    $\deltaTOA$            & \num{0.0}            &                         & Optical depth at TOA, by definition                                             \\
    $D$       & \num{1.66}                &                       & Diffusivity factor, from \cite[469]{Ramanathan}                                               \\
    $g$                & \num{9.80665}          & \unit{\metre\per\square\second}       & Standard gravitational acceleration of Earth                       \\
    $P_\text{g}$       & \num{1.013250e5}       & \unit{\pascal}                        & Standard pressure at ground level, from \cite[2]{US1976}           \\
    %    $R$                & \num{8.31446261815324} & \unit{\joule\per\kelvin\per\mole}     & Gas constant                                                       \\
    $R_{m,\text{air}}$ & \num{2.8705287e2}          & \unit{\joule\per\kelvin\per\kilogram} & Specific gas constant of air \\
    $\sigma$              & \num{5.670374419e-8}           & \unit{\watt\per\square\metre\per\kelvin\tothe{4}}         & Stefan-Boltzmann constant                    \\
    $S_0$              & \num{1361.0}           & \unit{\watt\per\square\metre}         & Nominal total solar irradiance, from \cite{IAU}                    \\
    %    $R_\text{sun}$     & \num{6.957e8}          & \unit{\metre}                         & Nominal solar radius, from \cite{IAU}                              \\
    %    $T_\text{earth}$   & \num{288.15}           & \unit{\kelvin}                        & Earth's surface temperature based on \cite{US1976}                 \\
    %    $T_\text{sun}$     & \num{5772}             & \unit{\kelvin}                        & Solar surface temperature, from \cite{IAU}                         \\
    $z_\text{g}$       & \num{0}                & \unit{\metre}                         & Nominal ground level                                               \\
    \midrule
    $\delta_\text{g}$            & \num{0.8}            &                         & Optical depth at ground level of Earth, from \cite[56]{Catling}                                             \\
    $\mu_m$            & $\frac{\delta_\text{g} g}{P_\text{g} - \PTOA}$            &                         & Mass attenuation coefficient of the atmosphere of Earth                                           \\
    $N$            & \num{100}            &                         & Number of atmospheric layers                                             \\
    %    $\nu_\text{min}$            & \num{100}            & \unit{\per\centi\metre}                         & Arbitrary minimum boundary for EM spectrum                                             \\
    %    $\nu_\text{max}$            & \num{100000}            & \unit{\per\centi\metre}                         & Arbitrary maximum boundary for EM spectrum                                             \\
    $P_0$       & \num{1e5}       & \unit{\pascal}                        & Arbitrary reference value for pressure           \\
    $\PTOA$            & \num{3}            & \unit{\pascal}                         & Arbitrary TOA pressure of Earth                                            \\ 
    $z_0$            & \num{2000}            & \unit{\metre}                        & Arbitrary constant set in equation~\ref{eq:optical_depth_altitude_2} for normalisation                                            \\
    $\zTOA$            & \num{55000}            & \unit{\metre}                         & Arbitrary TOA altitude of Earth                                            \\
    \bottomrule
  \end{tabular}
\end{table*}



\section{Analytical solution of radiative equilibrium}
The modelled atmosphere is in Local Thermal Equilibrium (LTE) and does not scatter radiation. With these hypotheses the RTE becomes Schwarzchild's equation
\begin{equation}
  \label{eq:schwarzchild}
  \frac{1}{\mu_m \varrho} \odv*{L(\nu, s)}{s} = B_\nu(\nu, T) - L(\nu, s)
  \quad ,
\end{equation}
where $L(\nu, s)$ is the spectral radiance at point $s$ of the optical path and $B_\nu(\nu, T)$ is Planck's function (cfr. section~\ref{sec:Radiometric quantities}).

To apply equation~\eqref{eq:schwarzchild} to irradiances, first it is integrated over the whole EM spectrum, then it is integrated over the solid angle corresponding to a hemisphere. This second integration brings a factor $D$ which is multiplied to $\delta$ to consider the diffusion of radiation.
Optical depth $\delta' = D \delta$ is used as vertical coordinate, hence the resulting equations for the upward and downward irradiances are:
\begin{align}
  \label{eq:schwarzchild_upward}
  - \odv*{E_\text{U}(\delta')}{\delta'} & = \sigma T(\delta')^4 - E_\text{U}(\delta') \quad , \\
  \label{eq:schwarzchild_downward}
  \odv*{E_\text{D}(\delta')}{\delta'} & = \sigma T(\delta')^4 - E_\text{D}(\delta')
  \quad .
\end{align}
Boundary conditions are $E_\text{D}(0) = 0$ because energy released to atmosphere at TOA by the downward flux is negligible and $E_\text{U}(0)$ is a constant called Outgoing Longwave Radiation (OLR).

For the condition of radiative equilibrium the OLR is equal to the irradiance arrived at TOA from outside the atmosphere:
\begin{equation}
  \label{eq:radiative_equilibrium}
  E_\text{U}(0) = (1 - A) \frac{S_0}{4}
  \quad .
\end{equation}
When temperature reaches the steady state, equations~\eqref{eq:schwarzchild_upward} and~\eqref{eq:schwarzchild_downward} are coupled by equation
\begin{equation}
  \label{eq:temperature_steady_state}
  \odv*{\big( E_\text{U}(\delta') - E_\text{D}(\delta') \big)}{\delta'} = 0
  \quad ,
\end{equation}
which has solution
\begin{equation}
  \label{eq:temperature_steady_state_solution}
  E_\text{U}(\delta') - E_\text{D}(\delta') = (1 - A) \frac{S_0}{4}
\end{equation}
in agreement with the hypothesis of atmosphere transparent to radiation from outside the atmosphere.

With these information and by adding and subtracting equations~\eqref{eq:schwarzchild_upward} and~\eqref{eq:schwarzchild_downward}, the equation for the temperature of the steady state is obtained,
\begin{equation}
  \label{eq:temperature_radiative_equilibrium}
  2 \sigma \odv*{T(\delta')^4}{\delta'} = (1 - A) \frac{S_0}{4}
  \quad ,
\end{equation}
and the solution is
\begin{equation}
  \label{eq:temperature_radiative_equilibrium_solution}
  T(\delta) = \bigg( (1 - A) \frac{S_0}{8 \sigma} (1 + D \delta) \bigg)^\frac{1}{4}
  \quad .
\end{equation}
plotted in figure~\ref{fig:temperature_radiative_equilibrium}. The code used to create the plot is~\ref{lst:radiative_equilibrium}.
\begin{figure*}[h]
  \centering
  \includegraphics*[keepaspectratio=true,width=0.75\textwidth]{temperature_radiative_equilibrium}
  \caption{Steady state vertical temperature profile of a grey atmosphere in radiative equilibrium. Lower altitudes are candidate to present instability due to higher values of the slope.}
  \label{fig:temperature_radiative_equilibrium}
\end{figure*}



\newpage
\appendix

\onecolumn
\section{Source code}
In this section the \cpp\ code used to obtain the results presented in this work is shown and commented.
% MC show the whole source code, splitted in sections.

% MC some thoughts about the development of the code.
First, the parametrization of the vertical coordinate is chosen among three alternatives: altitude $z$ in \unit{\metre}, atmospheric pressure $P$ in \unit{\pascal}, coordinate $\sigma = \frac{P - \PTOA}{P_S - \PTOA}$ adimensional, with $\PTOA$ pressure at the top of the modelised atmosphere and $P_S$ pressure at the surface. One parametrisation can be written in term of another through a monotonic function (e.g. pressure decreases with altitude, cfr. section~\ref{sec:Relation between pressure and altitude}). For the initial development the altitude $z$ is chosen as vertical coordinate because it is more intuitive, moreover plots in \cite{TTAPS-I} are expressed in terms of both $z$ and $P$.

Second, the atmospheric layers are configured. In \cite{TTAPS-I} 20 layers are used and they are numbered from the top of the atmosphere down as it is common in RCMs. The vertical coordinate refers to the center of each layer, with the excpetion of the last layer which is in direct contact with the surface and needs to be treated separately. % MC "Temperatures are calculated at the midpoints of the layers, and fluxes are computed at the layer boundaries."\cite[449]{Catling}
Therefore two arrays are needed: one for the point and one with the corresponding layer thicknesses. Values are then assigned as double precision numbers. The value corresponding to the top of the atmosphere is set in a proper variable and a uniform distribution of layer thicknesses is assumed for ease.

\lstinputlisting[language=C++,style=mystyle]{../code/main.cpp}
\twocolumn



\section{Mathematical derivations}
In this appendix mathematical derivations of some ancillary results and formulae used in the main text are explicitly shown.



\subsection{Relation between pressure and altitude}
\label{sec:Relation between pressure and altitude}
A general result regarding planetary atmospheres is that atmospheric pressure decreases with increasing altitude. Theoretical relations which approximate this behaviour can be obtained. Hypotheses considered in section~\ref{sec:Introduction} are valid.

If density is assumed constant, equation~\eqref{eq:hydrostatic_equilibrium} can be solved easily resulting in a linear dependence of pressure $P$ on altitude $z$,
\begin{equation}
  \label{eq:pressure_constant_density}
  P(z) = P_0 - \varrho g (z - z_0)
  \quad ,
\end{equation}
where $(z_0, P_0)$ is a reference point inside the atmosphere.

If density is not constant its expression is given by the ideal gas law (cfr. equation~\eqref{eq:ideal_gas_law}) and, assuming constant temperature $T$, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:hydrostatic_equilibrium_ideal_gas_law_constant_temperature}
  \begin{split}
    & \odif{P} = - \frac{P g}{R_m T} \odif{z} \iff \\
    \iff & \frac{\odif{P}}{P} = - \frac{g}{R_m T} \odif{z}
  \end{split}
\end{equation}
with solution
\begin{equation}
  \label{eq:pressure_constant_temperature}
  \begin{split}
    & \ln(P') \bigg|_{P_0}^{P(z)} = - \frac{g}{R_m T} z' \bigg|_{z_0}^{z} \iff \\
    \iff & P(z) = P_0 \exp{\bigg( - \frac{g}{R_m T} (z - z_0) \bigg)}
    \quad .
  \end{split}
\end{equation}
This relation is not meaningful, since the aim of the work is to derive the non-constant temperature profile of the atmosphere. However, it can be used inside atmospheric layers where the temperature is considered constant (e.g. stratosphere).

A better approximation assumes non-constant density and constant lapse rate $\Gamma$, hence temperature depends linearly on altitude,
\begin{equation}
  \label{eq:constant_lapse_rate}
  \Gamma = - \frac{\odif{T}}{\odif{z}} \impliedby T(z) = T_0 - \Gamma (z - z_0)
  \quad ,
\end{equation}
with $T_0$ temperature corresponding to reference altitude $z_0$. Using these assumptions and the density rewritten through the ideal gas law \eqref{eq:ideal_gas_law}, equation~\eqref{eq:hydrostatic_equilibrium} becomes
\begin{equation}
  \label{eq:hydrostatic_equilibrium_ideal_gas_law_constant_lapse_rate}
  \begin{split}
    & \odif{P} = - \frac{P g}{R_m T} \bigg( - \frac{\odif{T}}{\Gamma} \bigg) \iff \\
    \iff & \frac{\odif{P}}{P} = \frac{g}{R_m \Gamma} \frac{\odif{T}}{T}
    \quad ,
  \end{split}
\end{equation}
which has solution
\begin{equation}
  \label{eq:pressure_constant_lapse_rate}
  \begin{split}
    & \ln(P') \bigg|_{P_0}^{P(z)} = \frac{g}{R_m \Gamma} \ln(T') \bigg|_{T_0}^{T(z)} \iff \\
    \iff & P(z) = P_0 \bigg( \frac{T_0 - \Gamma (z - z_0)}{T_0} \bigg)^\frac{g}{R_m \Gamma}
    \quad .
  \end{split}
\end{equation}

Equation \eqref{eq:pressure_constant_lapse_rate} can be used also with a piecewise constant lapse rate in altitude intervals where it is not null. Otherwise, in altitude intervals where lapse rate is null, equation \eqref{eq:pressure_constant_temperature} is valid with appropriate boundary conditions to ensure continuity between layers.



\subsection{Radiometric quantities}
\label{sec:Radiometric quantities}
Refer to \cite{CIE} for more details on quantities reviewed in this section.

Consider electromagnetic radiation emitted by a point source. The total emitted power is called \emph{radiant flux}, with unit \unit{\watt}. The density of radiant flux with respect to a solid angle in the direction of emission is called \emph{radiant intensity}, expressed in \unit{\watt\per\steradian}. When radiation interacts with a surface, i.e. it gets absorbed, transmitted or reflected, its radiant intensity distributed over the surface is measured through \emph{radiance} in \unit{\watt\per\square\metre\per\steradian}. If the area on which the radiation is incident is expressed through the solid angle it subtends, the integral of radiance over this solid angle is called \emph{irradiance}, expressed in \unit{\watt\per\square\metre}. Note that the coordinate system where the solid angles of radiant intensity and irradiance are defined may not be the same. Radiant flux emitted by a body normalised over the surface of emission is measured by \emph{radiant exitance} in \unit{\watt\per\square\metre}.

% MC if needed make a consideration for the case where there is no source and only the radiation incident on a surface is considered. This phenomenon is addressed as diffusion.

All previous quantities can be expressed as densities with respect to the wavelength or the wavenumber and the adjective \emph{spectral} is prefixed to their names. Their units are divided by the respective spectral quantity (e.g. spectral radiance with wavenumber in \unit{\per\centi\metre} has units \unit{\watt\per\metre\squared\centi\metre\per\steradian}).

Spectral radiance of a blackbody is given by Planck's law
\begin{equation}
  \label{eq:spectral_radiance_blackbody}
  B_\nu (\nu, T) = 2 h c^2 \nu^3 \frac{1}{e^\frac{h c \nu}{k_B T} - 1}
  \quad ,
\end{equation}
where $\nu$ is the wavenumber in unit \unit{\per\centi\metre}, $T$ in unit \unit{\kelvin} is the temperature of the emitting body and the other quantities are constants (cfr. table~\ref{tab:constants}).
Note that Planck's law has different form when it is expressed in terms of wavelength, due to its definition as density and the resulting change of variables:
\begin{equation}
  \label{eq:spectral_radiance_blackbody_lambda}
  B_\lambda (\lambda, T) = \frac{2 h c^2}{\lambda^5} \frac{1}{e^\frac{h c}{\lambda k_B T} - 1}
  \quad .
\end{equation}

If radiance is isotropic, i.e. it is not dependent on the direction of the radiation, the corresponding irradiance is proportional. For instance, if the radiation is absorbed by a hemispheric surface approximated by a blackbody, the spectral irradiance of the surface is
\begin{equation}
  \label{eq:spectral_irradiance_blackbody_hemisphere}
  \begin{split}
    & \int B_\nu (\nu, T) \odif{\phi} \sin(\theta) \odif{\theta} \cos(\theta) = \\
    & = B_\nu (\nu, T) \int_0^{2\pi} \odif{\phi} \int_0^\frac{\pi}{2} \sin(\theta) \cos(\theta) \odif{\theta} = \\
    & = 2 \pi B_\nu (\nu, T) \int_0^1 \sin(\theta) \odif{(\sin(\theta))} = \\
    & = 2 \pi B_\nu (\nu, T) \frac{1}{2} = \\
    & = \pi B_\nu (\nu, T)
    \quad ,
  \end{split}
\end{equation}
where spherical coordinates are used to describe the surface and the term $\cos(\theta)$ considers the component of radiation along the normal of the infinitesimal solid angle.



\subsection{Radiation attenuation}
\label{sec:Radiation attenuation}
Radiation crossing a medium loses energy due to absorption and scattering. The effect of chemical species on these processes is quantified through the \emph{attenuation coefficient} (commonly called \emph{extinction coefficient} in atmospheric sciences), which has different definitions based on the way it is derived (cfr. \cite[44]{Catling}). The attenuation coefficient is the sum of \emph{absorption coefficient} and \emph{scattering coefficient} which contain information on the attenuation due to the respective physical processes. The \emph{optical depth} (also called \emph{optical thickness}) takes in consideration the amount of substance involved in the absorption.

Ratios between radiant fluxes are related by the conservation of energy: the sum of \emph{internal transmittance} and \emph{internal absorptance} is 1, as well as the sum of \emph{reflectance}, \emph{absorptance} and \emph{transmittance}.

In general these coefficients are functions of wavelength or wavenumber, in which case the prefix \emph{spectral} is adopted. If the medium is a fluid, they depends on temperature and pressure of the medium.
Another related quantity is the spectral internal transmittance
\begin{equation}
  \label{eq:spectral_internal_transmittance}
  \tau_\text{i}(\nu, s, s_0) = e^{-\delta(\nu, s, s_0)}
  \quad ,
\end{equation}
where $\delta(\nu, s, s_0)$ is the spectral optical depth, which depends only on the spectral attenuation coefficient $\mu(\nu, s')$ of the medium traversed by the radiation from $s_0$ to $s$ on the optical path. In the RCM optical paths are straight and form an angle $\theta$ with the direction normal to the layers, hence the definition of the spectral optical depth becomes:
\begin{equation}
  \label{eq:spectral_optical_depth}
  \delta(\nu, s, s_0) = \frac{1}{\cos \theta} \int_{s_0}^{s} \mu(\nu, s') \odif{s'}
  \quad .
\end{equation}
If the absorbing species do not interact, $\mu(\nu, s')$ is simply the sum of the spectral attenuation coefficients of the individual components of the medium.

Moreover, if the medium is homogenoeus, in the sense that quantities affecting radiative calculations are not dependent on spatial position (e.g. attenuation coefficients $\mu$ are constant inside the medium), the spectral attenuation coefficient depends only on the concentration of the absorbing species contained, hence the spectral attenuation coefficient can be rewritten as
\begin{equation}
  \label{eq:spectral_attenuation_coefficient}
  \mu(\nu, s') = \mu_m(\nu) \rho(s')
\end{equation}
where $\mu_m(\nu)$ is the spectral mass attenuation coefficient and $\rho(s')$ is the volumetric mass density of the absorber.

Names of radiative properties ending with suffix \emph{-ance} are generally used for rough surfaces, while suffix \emph{-ivity} indicates smooth surfaces. In this work the former is adopted. Refer to \cite[20]{Modest} for more information and to the definition of spectral absorptivity in \cite{CIE} for an example of the difference.



\subsection{Quantities commonly used in atmospheric sciences}
\label{sec:Quantities commonly used in atmospheric sciences}
Earth's surface horizontal profile is not uniform, hence altitude and pressure near ground level could present sudden variations. In models where this is taken into consideration, the sigma coordinate system is commonly used instead, defined by
\begin{equation}
  \label{eq:sigma_coordinate}
  \sigma = \frac{P - \PTOA}{P_\text{g} - \PTOA}
  \quad .
\end{equation}
To avoid confusion, in this work symbol $\sigma$ is used for the Stefan-Boltzmann constant (cfr. table~\ref{tab:constants}), except for equation~\eqref{eq:sigma_coordinate}.

An alternative quantity evaluated in place of $T(t,z)$ for a given parcel of fluid is the potential temperature
\begin{equation}
  \label{eq:potential_temperature}
  \theta(t,z) = T(t,z) \bigg( \frac{P_0}{P(z)} \bigg)^\frac{R_m}{c_P}
  \quad ,
\end{equation}
where $P_0$ is a reference pressure and quantities $P(z)$, $R_m$ and $c_P$ refer to the fluid.



\section{Supplementary information}



\subsection{Plotting}
\label{sec:Plotting}
Software gnuplot is used to generate plots shown in this work. Output values from the simulation are stored in a DAT file.



\newpage
\printbibliography[heading=bibintoc]
\end{document}
